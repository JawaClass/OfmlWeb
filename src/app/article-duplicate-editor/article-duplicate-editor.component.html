

<section>
  <h2>Session erstellen: {{ session.name }}</h2>
</section>
<section>
  <p> Alle Artikelnummern {{ articles.length }}</p>
  <p> Eindeutige Artikelnummern {{ uniqueArticlesByArticleNr().length}}</p>
  <p> Doppelte Artikelnummern {{ activeArticlesByArticleNr().length - uniqueActiveArticlesByArticleNr().length}}</p>
</section>


<button type="submit" [disabled]="!selectionIsValid()" mat-raised-button color="primary"
  matTooltip="Ohne Duplikate fortfahren"
  style="display: inline-block; width: 20%; height: 50px; margin-bottom: 25px;"
  (click)="confirmSelection()">
  Auswahl bestätigen
</button>

@if (isProcessing) {
  <section style="color: white; margin-top: 15px; padding: 0 0 30px 30px; display: flex; justify-content: space-evenly;">
      <strong>Session wird mit OCD Daten erstellt...</strong>
  </section>
  <div style="display: flex; justify-content: center; margin-bottom: 15px;">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  </div>
  }

<mat-chip-listbox multiple>

  @for (program of programs(); track program; let idx = $index) {

  <mat-chip-option [selected]="isProgramActive(program)" (click)="toggleActive(program)">
    {{ program }}
  </mat-chip-option>

  }

</mat-chip-listbox>
 

<table>
  <tr>
    <th>Artikel</th>
    <th>Kürzel</th>
    <th>Serie</th>
    <th>Kruztext</th>
    <th>aktiv</th>
  </tr>
  @for (articleNr of articlesNrUnique; track articleNr; let idx = $index) {

    <tr>
      <strong style="display: flex; gap: 10px;">
        <span>{{ articleNr }}</span>
        <span>{{ articlesGroupedByArticleNr[articleNr].length }}x</span>
      </strong>
    </tr>
    

    @for (a of articlesGroupedByArticleNr[articleNr]; track a; let idx = $index) {

      <tr>
        <td style="padding: 0 10px 0 10px">{{ a.item.article_nr }}</td>
        <td style="padding: 0 10px 0 10px">{{ a.item.series }}</td>
        <td style="padding: 0 10px 0 10px">{{ a.item.sql_db_program }}</td>
        <td style="padding: 0 10px 0 10px">{{ a.item.ocd_artshorttext }}</td>
        <td>

          <mat-checkbox style="padding: 0 10px 0 10px" [(ngModel)]="a.active"></mat-checkbox>

          <!--
            <button style="margin-left: 10px; background-color: transparent; border: none; cursor: pointer; color: red;">
            <mat-icon style="align-self: baseline;" (click)="toggleArticle(a)" fontIcon="delete_outline">
            </mat-icon>
          </button>
          -->
        </td>
      </tr>
      
      
    }

    <tr style="height: 10px;"></tr>
  
  }
</table>



<!--
  
@if (notUniqueArticles().length) {

<h2>
  <strong style="font-size: large;">{{ notUniqueArticles().length }} Artikel doppeln sich. Entferne zuerst die
    Duplikate.</strong>
</h2>

<table>

  @for (articleDuplicate of notUniqueArticles(); track articleDuplicate.articleNr; let idx = $index) {


  <tr>
    <strong>{{ articleDuplicate.articleNr }} {{ articleDuplicate.duplicates.length }} Stk.</strong>
  </tr>



  @for (duplicate of articleDuplicate.duplicates; track duplicate.articleNr) {
  <tr>

    <td><strong>{{ duplicate.program }}</strong></td>
    <td>{{ duplicate.articleNr }}</td>
    <td>{{ duplicate.shorttext }}</td>
    <td>
      <button style="margin-left: 10px; background-color: transparent; border: none; cursor: pointer; color: red;">
        <mat-icon style="align-self: baseline;" (click)="removeArticleItem(duplicate)" fontIcon="delete_outline">
        </mat-icon>
      </button>
    </td>
  </tr>
  }

  }
</table>
} @else {

<table>
  @for (article of getAllActiveArticleRefs(); track article.articleNr; let idx = $index) {
  <tr>
    <td>{{ idx }}.</td>
    <td>{{ article.articleNr }}</td>
    <td>{{ article.program }}</td>
  </tr>
  }

</table>

}

-->